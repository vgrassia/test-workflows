---
name: Test

on:
  push:
  workflow_dispatch:

jobs:
  test:
    name: Workflow Testing
    runs-on: ubuntu-20.04
    steps:
    - name: Azure Login
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}

    - name: Azure CLI script
      id: get-secrets
      uses: azure/CLI@v1
      with:
        inlineScript: |
          MYVALUE=$(az keyvault secret show --vault-name vgrassia-test-kv --name my-test-secret --query value --output tsv)
          echo "::add-mask::$MYVALUE"
          echo "::set-output name=my_test_output::$MYVALUE"

    - name: TEST STEP
      run: |
        echo "TEST VALUE: ${{ steps.get-secrets.outputs.my_test_output }}"
